import{a as $,c as tn,d as en,e as M}from"./chunk-VBTJVPAM.mjs";import{q as nn,t as T}from"./chunk-KOAUBVO6.mjs";import{a as A}from"./chunk-3CLYWZYZ.mjs";import{a as Y}from"./chunk-ONDQ4MK7.mjs";import{a as rn}from"./chunk-KUOIRTNL.mjs";import{a as l,c as f,d as g}from"./chunk-L4Q2XTHT.mjs";import{c as X,d as z,e as Z,f as N,g as j,h as J,i as Q}from"./chunk-TGLSJGFO.mjs";import{a as L}from"./chunk-BWFJHFBQ.mjs";import{b as R,d as F,e as _,f as D}from"./chunk-KVIVMWN5.mjs";import{b as H}from"./chunk-7CAEMK4R.mjs";import{a as K}from"./chunk-MIEV7J74.mjs";import{a as V}from"./chunk-AH44UPM4.mjs";import{a as O}from"./chunk-Y5M5DD64.mjs";import{e as P}from"./chunk-C67BKZND.mjs";import{b as W,c as U,f as C,g as S}from"./chunk-CYNQRMO5.mjs";import{b as h,d as p,e as q}from"./chunk-ZEXZ4CX5.mjs";import{a as v,b as E}from"./chunk-RAYJRFIG.mjs";import{a as G,c as k}from"./chunk-OKCU4GHN.mjs";import{a as x,c as B}from"./chunk-Y2VA7F5D.mjs";import{b as u}from"./chunk-IOSQVDZI.mjs";import{b}from"./chunk-AOCNYMMX.mjs";import{sha3_256 as an}from"@noble/hashes/sha3";async function On(n){if(nn(n))return fn(n);let{moduleAddress:e,moduleName:t,functionName:o}=T(n.function),a=await cn({key:"entry-function",moduleAddress:e,moduleName:t,functionName:o,aptosConfig:n.aptosConfig,abi:n.abi,fetch:tn});return mn({abi:a,...n})}function mn(n){let e=n.abi,{moduleAddress:t,moduleName:o,functionName:a}=T(n.function),r=$(n.typeArguments);if(r.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${r.length}`);let i=n.functionArguments.map((s,d)=>M(n.function,e,s,d,r));if(i.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${o}::${a}', expected ${e.parameters.length} but got ${i.length}`);let c=N.build(`${t}::${o}`,a,r,i);if("multisigAddress"in n){let s=u.from(n.multisigAddress);return new Z(new J(s,new Q(c)))}return new z(c)}async function Vn(n){let{moduleAddress:e,moduleName:t,functionName:o}=T(n.function),a=await cn({key:"view-function",moduleAddress:e,moduleName:t,functionName:o,aptosConfig:n.aptosConfig,abi:n.abi,fetch:en});return yn({abi:a,...n})}function yn(n){let e=n.abi,{moduleAddress:t,moduleName:o,functionName:a}=T(n.function),r=$(n.typeArguments);if(r.length!==e.typeParameters.length)throw new Error(`Type argument count mismatch, expected ${e.typeParameters.length}, received ${r.length}`);let i=n?.functionArguments?.map((c,s)=>M(n.function,e,c,s,r))??[];if(i.length!==e.parameters.length)throw new Error(`Too few arguments for '${t}::${o}::${a}', expected ${e.parameters.length} but got ${i.length}`);return N.build(`${t}::${o}`,a,r,i)}function fn(n){return new X(new j(b.fromHexInput(n.bytecode).toUint8Array(),n.typeArguments??[],n.functionArguments))}async function gn(n){let{aptosConfig:e,sender:t,payload:o,options:a,feePayerAddress:r}=n,i=P[e.network]?Promise.resolve({chain_id:P[e.network]}):O({aptosConfig:e}),c=a?.gasUnitPrice?Promise.resolve({gas_estimate:a.gasUnitPrice}):H({aptosConfig:e}),[{chain_id:s},{gas_estimate:d}]=await Promise.all([i,c]),m=a?.accountSequenceNumber!==void 0?Promise.resolve({sequence_number:a.accountSequenceNumber}):K({aptosConfig:e,accountAddress:t}),y;if(r&&u.from(r).equals(u.ZERO))try{let{sequence_number:w}=await m;y=w}catch{y="0"}else{let{sequence_number:w}=await m;y=w}let{maxGasAmount:un,gasUnitPrice:An,expireTimestamp:dn}={maxGasAmount:a?.maxGasAmount?BigInt(a.maxGasAmount):BigInt(2e5),gasUnitPrice:BigInt(d),expireTimestamp:BigInt(Math.floor(Date.now()/1e3)+20),...a};return new l(u.from(t),BigInt(y),o,BigInt(un),BigInt(An),BigInt(dn),new L(s))}async function Kn(n){let{aptosConfig:e,sender:t,payload:o,options:a,feePayerAddress:r}=n,i=await gn({aptosConfig:e,sender:t,payload:o,options:a,feePayerAddress:r});if("secondarySignerAddresses"in n){let c=n.secondarySignerAddresses?.map(s=>u.from(s))??[];return new rn(i,c,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}return new Y(i,n.feePayerAddress?u.from(n.feePayerAddress):void 0)}function Hn(n){let{signerPublicKey:e,transaction:t,secondarySignersPublicKeys:o,feePayerPublicKey:a}=n,r=I(e);if(t.feePayerAddress){let c=new g(t.rawTransaction,t.secondarySignerAddresses??[],t.feePayerAddress),s=[];o&&(s=o.map(y=>I(y)));let d=I(a),m=new _(r,t.secondarySignerAddresses??[],s,{address:t.feePayerAddress,authenticator:d});return new A(c.raw_txn,m).bcsToBytes()}if(t.secondarySignerAddresses){let c=new f(t.rawTransaction,t.secondarySignerAddresses),s=[];s=o.map(m=>I(m));let d=new F(r,t.secondarySignerAddresses,s);return new A(c.raw_txn,d).bcsToBytes()}let i;if(r instanceof h)i=new R(r.public_key,r.signature);else if(r instanceof p)i=new D(r);else throw new Error("Invalid public key");return new A(t.rawTransaction,i).bcsToBytes()}function I(n){if(n instanceof v){if(n.publicKey instanceof x)return new p(n,new E(new B(new Uint8Array(64))));if(n.publicKey instanceof G)return new p(n,new E(new k(new Uint8Array(64))))}return new h(new x(n.toUint8Array()),new B(new Uint8Array(64)))}function Ln(n){let{signer:e,transaction:t}=n,o=wn(t);return e.signWithAuthenticator(o)}function pn(n){let{transaction:e,senderAuthenticator:t,feePayerAuthenticator:o,additionalSignersAuthenticators:a}=n,r=sn(e);if((o||a)&&(r instanceof f||r instanceof g))return Tn(r,t,o,a);if(t instanceof h&&r instanceof l){let i=new R(t.public_key,t.signature);return new A(r,i).bcsToBytes()}if((t instanceof p||t instanceof q)&&r instanceof l){let i=new D(t);return new A(r,i).bcsToBytes()}throw new Error(`Cannot generate a signed transaction, ${t} is not a supported account authentication scheme`)}function on(n){let e=an.create();for(let t of n)e.update(t);return e.digest()}var ln=on(["APTOS::Transaction"]);function Xn(n){let e=pn(n);return new b(on([ln,new Uint8Array([0]),e])).toString()}function sn(n){return n.feePayerAddress?new g(n.rawTransaction,n.secondarySignerAddresses??[],n.feePayerAddress):n.secondarySignerAddresses?new f(n.rawTransaction,n.secondarySignerAddresses):n.rawTransaction}function Tn(n,e,t,o){if(n instanceof g){if(!t)throw new Error("Must provide a feePayerAuthenticator argument to generate a signed fee payer transaction");let a=new _(e,n.secondary_signer_addresses,o??[],{address:n.fee_payer_address,authenticator:t});return new A(n.raw_txn,a).bcsToBytes()}if(n instanceof f){if(!o)throw new Error("Must provide a additionalSignersAuthenticators argument to generate a signed multi agent transaction");let a=new F(e,n.secondary_signer_addresses,o??[]);return new A(n.raw_txn,a).bcsToBytes()}throw new Error(`Cannot prepare multi signers transaction to submission, ${typeof n} transaction is not supported`)}function wn(n){let e=sn(n),t=an.create();if(e instanceof l)t.update(C);else if(e instanceof f)t.update(S);else if(e instanceof g)t.update(S);else throw new Error(`Unknown transaction type to sign on: ${e}`);let o=t.digest(),a=e.bcsToBytes(),r=new Uint8Array(o.length+a.length);return r.set(o),r.set(a,o.length),r}async function cn({key:n,moduleAddress:e,moduleName:t,functionName:o,aptosConfig:a,abi:r,fetch:i}){return r||V(async()=>i(e,t,o,a),`${n}-${a.network}-${e}-${t}-${o}`,1e3*60*5)()}export{On as a,mn as b,Vn as c,yn as d,gn as e,Kn as f,Hn as g,I as h,Ln as i,pn as j,on as k,Xn as l,sn as m,Tn as n,wn as o};
//# sourceMappingURL=chunk-54BANKLA.mjs.map